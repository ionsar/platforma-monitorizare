- name: Deploy platforma de monitorizare
  hosts: frontend
  become: true

  vars:
    monitor_dir: "/home/ansible/platforma-monitorizare"

  tasks:
    - name: Creeaza directorul proiectului
      file:
        path: "{{ monitor_dir }}"
        state: directory
        owner: ansible
        group: ansible

    - name: Creeaza directorul sysmonitor
      file:
        path: "{{ monitor_dir }}/sysmonitor"
        state: directory
        owner: ansible
        group: ansible

    - name: Copiaza compose.yml
      copy:
        src: "../../compose.yml"
        dest: "{{ monitor_dir }}/compose.yml"
        owner: ansible
        group: ansible

    - name: Ruleaza docker compose
      command: "docker compose -f {{ monitor_dir }}/compose.yml up -d"

    - name: Copiaza verifica script
      copy:
        src: ../verifica.sh
        dest: "{{ monitor_dir }}/verifica.sh"
        owner: ansible
        group: ansible
        mode: '0755'

    - name: Executa script
      command: "{{ monitor_dir }}/verifica.sh"       
